<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mul.HealthyGYM.Dao.MpDao">

	<select id="findMemberById" parameterType="Integer"
			resultType="com.mul.HealthyGYM.Dto.MemberDto">
		select *
		from member
		where memberseq = #{memberseq}
	</select>

	<select id="findMemberinfoById" parameterType="Integer"
			resultType="com.mul.HealthyGYM.Dto.MemberinfoDto">
		select *
		from memberinfo
		where memberseq = #{memberseq}
	</select>

	<update id="profileUpdate" parameterType="com.mul.HealthyGYM.Dto.ProfileDto">
		UPDATE member m
			JOIN memberinfo mi
		ON m.memberseq = mi.memberseq
			SET m.email = #{email}, m.nickname = #{nickname}, m.profile = #{profile}, mi.name = #{name}, mi.age = #{age}, mi.gender = #{gender}, mi.phone = #{phone}, mi.mbti = #{mbti}
		WHERE m.memberseq = #{memberseq}
	</update>

	<update id="pwdUpdate" parameterType="com.mul.HealthyGYM.Dto.MemberDto">
		UPDATE member
		SET pwd = #{pwd}
		WHERE memberseq = #{memberseq}
	</update>

	<select id="followingMembers" parameterType="Integer" resultType="com.mul.HealthyGYM.Dto.FollowDto">
		SELECT m.memberseq, f.foltarget, m.profile
		FROM follow f
				 JOIN member m ON m.nickname = f.foltarget
		WHERE f.memberseq = #{memberseq}
	</select>

	<select id="followerMembers" parameterType="Integer"
			resultType="com.mul.HealthyGYM.Dto.FollowDto">
		SELECT f.memberseq, m.nickname as foltarget, m.profile
		FROM follow f
				 JOIN member m ON m.memberseq = f.memberseq
		WHERE f.foltarget = (SELECT nickname FROM member WHERE memberseq = #{memberseq});
	</select>

	<insert id="inbodySave" parameterType="com.mul.HealthyGYM.Dto.InbodyDto">
		insert into inbody(inbodyseq, memberseq, uploaddate, weight, musclemass, bodyfatmass, imgpath)
		values (#{inbodyseq}, #{memberseq}, now(), #{weight}, #{musclemass}, #{bodyfatmass}, #{imgpath})
	</insert>

	<select id="inbodyList" parameterType="Integer"
			resultType="com.mul.HealthyGYM.Dto.InbodyDto">
		select *
		from inbody
		where memberseq = #{memberseq}
	</select>

</mapper>